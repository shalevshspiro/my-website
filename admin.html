<!DOCTYPE html>
<html lang="he">
<head>
  <script>
    firebase.auth().onAuthStateChanged(user => {
      if (!user || user.email !== "shalev6005@gmail.com") {
        window.location.href = "https://www.youtube.com/watch?v=Z6hLOCKTpsg&t=937s";
      }
    });
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ניהול כתבות - My Mind</title>
  <link rel="stylesheet" href="css/admin.css">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script src="js/firebase-config.js"></script>
  <script src="js/admin.js" defer></script>
</head>
<body>
<a href="index.html" class="back-link">← חזרה לעמוד הראשי</a>

<h2>🔑 התחברות לניהול כתבות</h2>
<form id="loginForm">
  <input type="email" id="email" placeholder="אימייל" required>
  <input type="password" id="password" placeholder="סיסמה" required>
  <button type="submit">📌 התחבר</button>
</form>

<button id="logout" style="display:none;">🚪 התנתק</button>

<div id="adminPanel" style="display:none;">
  <h2>📝 הוספת כתבה חדשה</h2>
  <form id="articleForm">
    <label>🔹 כותרת הכתבה:</label>
    <input type="text" id="title" placeholder="כותרת" required>

    <label>📖 הקדמה:</label>
    <input type="text" id="intro" placeholder="הקדמה">

    <label>📂 קטגוריה:</label>
    <select id="category">
      <option value="articles">כתבות</option>
      <option value="life">חיים</option>
    </select>

    <label>🎭 ז'אנר:</label>
    <select id="genre"></select>

    <label>📓 תוכן הכתבה:</label>
    <div id="editor"></div>

    <label>🗼️ העלאת תמונות נוספות:</label>
    <input type="file" id="imageUpload" multiple>
    <button type="button" id="uploadImagesBtn">📄 העלה תמונות</button>
    <br>

    <!-- ✅ תוספת: הזנת כתובת URL לתמונה -->
    <label>📎 הוסף תמונה לפי קישור:</label>
    <input type="text" id="imageUrlInput" placeholder="הדבק קישור לתמונה מ־Cloudinary">
    <button type="button" id="addImageByUrl">📎 הוסף תמונה מקישור</button>
    <br>

    <div id="imagePreviewArea" style="margin-top: 20px;"></div>

    <label>🔖 תמונת לוגו:</label>
    <input type="file" id="logoUpload">
    <button type="button" id="uploadLogoBtn">📄 העלה לוגו</button>
    <br>
    <input type="text" id="logoImage" placeholder="או הדבק כאן קישור לתמונת לוגו מ״Cloudinary">

    <button type="submit">✅ צור כתבה</button>
  </form>
</div>

<!-- Quill Scripts -->
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const quill = new Quill('#editor', {
      theme: 'snow',
      placeholder: 'כתוב כאן את תוכן הכתבה...'
    });

    const form = document.getElementById("articleForm");
    form.addEventListener("submit", function () {
      let raw = quill.root.innerHTML;
      raw = raw
        .replace(/<p><br><\\/p>/g, '___PARAGRAPH___')
        .replace(/<\\/p><p>/g, '<br>')
        .replace(/^<p>/, '')
        .replace(/<\\/p>$/, '')
        .replace(/<\\/p>/g, '')
        .replace(/<p>/g, '')
        .replace(/___PARAGRAPH___/g, '</p><p>');
      const finalContent = `<p>${raw}</p>`;

      const hiddenInput = document.createElement("input");
      hiddenInput.type = "hidden";
      hiddenInput.name = "content";
      hiddenInput.id = "content";
      hiddenInput.value = finalContent;
      form.appendChild(hiddenInput);
    });

    // ✅ תוספת: הוספת תמונה לפי כתובת URL
    const addImageBtn = document.getElementById("addImageByUrl");
    if (addImageBtn) {
      addImageBtn.addEventListener("click", () => {
        const url = document.getElementById("imageUrlInput").value.trim();
        if (!url) return alert("❗ נא להדביק קישור קודם");
        if (typeof addImagePreview === "function") {
          addImagePreview(url);
        } else {
          alert("⚠️ addImagePreview לא מוגדרת עדיין");
        }
      });
    }
  });
</script>
</body>
</html>
